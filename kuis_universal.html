<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis PJOK - SDN Rawabuntu 03</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body{font-family:'Nunito',sans-serif;background:#e3f2fd;margin:0;padding:20px;color:#333}
        .container{max-width:600px;margin:auto;background:white;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
        h2, h3{text-align:center;color:#e91e63;margin-bottom:20px}
        
        .input-group{margin-bottom:15px}
        .input-group label{display:block;margin-bottom:5px;font-weight:700;font-size:14px}
        .form-control{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-family:inherit;box-sizing:border-box}
        .form-control:focus{border-color:#29b6f6;outline:none}

        .section-header{background:#0288d1;color:white;padding:10px 15px;border-radius:8px;margin:25px 0 15px;font-weight:800;font-size:16px}
        .soal-card{background:#f9fbe7;border:1px solid #dce775;padding:15px;border-radius:10px;margin-bottom:15px}
        .soal-text{font-weight:700;margin-bottom:10px;display:block}
        
        .option-label{display:block;padding:10px;background:white;border:1px solid #ddd;border-radius:8px;margin-bottom:5px;cursor:pointer;transition:0.2s}
        .option-label:hover{background:#e1f5fe;border-color:#29b6f6}
        input[type="radio"]{margin-right:10px}

        .btn{width:100%;padding:14px;border:none;border-radius:50px;font-weight:800;font-size:16px;cursor:pointer;margin-top:20px;text-transform:uppercase;transition:0.3s}
        .btn-start{background:linear-gradient(to right, #e91e63, #c2185b);color:white}
        .btn-submit{background:linear-gradient(to right, #43a047, #2e7d32);color:white}
        .btn-back{background:#757575;color:white}

        #loading-overlay{display:none;text-align:center;padding:20px}
        #hasil-area{display:none;text-align:center}
        .score-circle{width:120px;height:120px;background:#e91e63;color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:40px;font-weight:800;margin:0 auto 20px}
        #error-box { background: #ffebee; color: #c62828; padding: 15px; border-radius: 8px; border: 1px solid #ffcdd2; margin-bottom: 20px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="error-box"></div>

    <div id="form-identitas">
        <h2>üìã DATA SISWA</h2>
        <div class="input-group">
            <label>Nama Lengkap Siswa</label>
            <input type="text" id="inputNama" class="form-control" placeholder="Tulis nama lengkap...">
        </div>
        <div class="input-group">
            <label>Kelas</label>
            <select id="inputKelas" class="form-control">
                <option value="">-- Pilih Kelas --</option>
                <option value="1A">Kelas 1A</option>
                <option value="1B">Kelas 1B</option>
                <option value="1C">Kelas 1C</option>
                <option value="1D">Kelas 1D</option>
                <option value="1E">Kelas 1E</option>
            </select>
        </div>
        <div class="input-group">
            <label>Nama Guru PJOK</label>
            <input type="text" id="inputGuru" class="form-control" value="Bapak Rendi">
        </div>
        <div class="input-group">
            <label>Asal Sekolah</label>
            <input type="text" id="inputSekolah" class="form-control" value="SDN Rawabuntu 03">
        </div>
        <button class="btn btn-start" onclick="mulaiKuis()">üöÄ MULAI MENGERJAKAN</button>
    </div>

    <div id="lembar-kuis" style="display:none;">
        <h3 id="judul-kuis">Soal PJOK</h3>
        <div id="container-soal"></div>
        <button class="btn btn-submit" onclick="kirimJawaban()">‚úÖ KIRIM JAWABAN</button>
    </div>

    <div id="loading-overlay"><h3>‚è≥ Sedang Mengirim...</h3></div>
    <div id="hasil-area">
        <h2>üéâ SELESAI!</h2>
        <p>Nilai Pilihan Ganda Kamu:</p>
        <div class="score-circle" id="skor-akhir">0</div>
        <p>Jawaban Isian & Essay sudah dikirim ke Bapak Guru.</p>
        <button class="btn btn-back" onclick="window.history.back()">üè† KEMBALI KE MATERI</button>
    </div>
</div>

<script>
    // --- 1. DATA SOAL ---
    const BANK_SOAL = {
        "A": {
            pg: [
                {q:"Berjalan adalah gerakan berpindah tempat dengan melangkahkan kaki secara bergantian. Gerakan ini disebut ‚Ä¶",opt:["Gerak lokomotor","Gerak non-lokomotor","Gerak diam"],ans:0},
                {q:"Saat berjalan, posisi badan yang benar adalah ‚Ä¶",opt:["Membungkuk","Tegak","Miring"],ans:1},
                {q:"Berjalan melatih kekuatan otot bagian ‚Ä¶",opt:["Kepala","Perut","Kaki"],ans:2},
                {q:"Berjalan bersama teman melatih sikap ‚Ä¶",opt:["Malas","Kerja sama","Marah"],ans:1},
                {q:"Pandangan mata saat berjalan sebaiknya ke arah ‚Ä¶",opt:["Belakang","Depan","Bawah"],ans:1},
                {q:"Berjalan dengan baik membuat tubuh menjadi ‚Ä¶",opt:["Sakit","Sehat","Lemah"],ans:1},
                {q:"Saat berjalan ayunan tangan bergerak secara ‚Ä¶",opt:["Kaku","Santai","Diam"],ans:1},
                {q:"Berjalan di sekolah harus dilakukan dengan ‚Ä¶",opt:["Sembarangan","Hati-hati","Cepat"],ans:1},
                {q:"Berjalan termasuk olahraga yang ‚Ä¶ dilakukan anak",opt:["Sulit","Mudah","Berbahaya"],ans:1},
                {q:"Manfaat berjalan bagi tubuh adalah ‚Ä¶",opt:["Menjadi sakit","Menjadi sehat","Menjadi lelah"],ans:1},
                {q:"Berjalan melatih keseimbangan tubuh ‚Ä¶",opt:["Ya","Tidak","Kadang"],ans:0},
                {q:"Berjalan setiap hari membuat tubuh ‚Ä¶",opt:["Kuat","Lemah","Sakit"],ans:0},
                {q:"Saat berjalan kaki melangkah secara ‚Ä¶",opt:["Asal","Teratur","Melompat"],ans:1},
                {q:"Berjalan termasuk olahraga yang ‚Ä¶ dilakukan bersama",opt:["Tidak boleh","Boleh","Berbahaya"],ans:1},
                {q:"Setelah berjalan jauh sebaiknya kita ‚Ä¶",opt:["Terus berjalan","Istirahat","Menangis"],ans:1}
            ],
            essay: ["Apa yang dimaksud dengan berjalan?", "Sebutkan dua manfaat berjalan bagi tubuh!", "Mengapa kita harus berjalan dengan sikap tubuh yang benar?", "Sebutkan contoh kegiatan berjalan di sekolah!", "Mengapa berjalan harus dilakukan dengan hati-hati?"]
        },
        "B": {
            pg: [
                {q:"Lari adalah gerakan berpindah tempat dengan langkah yang ‚Ä¶",opt:["Pelan","Cepat","Diam"],ans:1},
                {q:"Berlari melatih kekuatan otot bagian ‚Ä¶",opt:["Kaki","Tangan","Leher"],ans:0},
                {q:"Sebelum berlari kita harus melakukan ‚Ä¶",opt:["Tidur","Pemanasan","Makan"],ans:1},
                {q:"Saat berlari, jantung berdetak lebih ‚Ä¶",opt:["Lambat","Cepat","Diam"],ans:1},
                {q:"Berlari membuat tubuh menjadi ‚Ä¶",opt:["Sehat","Sakit","Lemah"],ans:0},
                {q:"Pandangan mata saat berlari mengarah ke ‚Ä¶",opt:["Depan","Bawah","Belakang"],ans:0},
                {q:"Berlari bersama teman melatih sikap ‚Ä¶",opt:["Marah","Kerja sama","Malas"],ans:1},
                {q:"Lari kecil disebut juga ‚Ä¶",opt:["Sprint","Jogging","Maraton"],ans:1},
                {q:"Berlari di sekolah harus memperhatikan ‚Ä¶",opt:["Mainan","Keselamatan","Sepatu"],ans:1},
                {q:"Berlari secara teratur membuat tubuh ‚Ä¶",opt:["Kuat","Lemah","Sakit"],ans:0},
                {q:"Setelah berlari jika lelah sebaiknya ‚Ä¶",opt:["Terus","Istirahat","Menangis"],ans:1},
                {q:"Berlari melatih pernapasan agar lebih ‚Ä¶",opt:["Lemah","Kuat","Pendek"],ans:1},
                {q:"Berlari adalah olahraga yang ‚Ä¶ dilakukan anak",opt:["Mudah","Sulit","Berbahaya"],ans:0},
                {q:"Tempat berlari yang baik adalah ‚Ä¶",opt:["Licin","Gelap","Aman"],ans:2},
                {q:"Manfaat utama berlari adalah tubuh menjadi ‚Ä¶",opt:["Sehat","Sakit","Lemah"],ans:0}
            ],
            essay: ["Apa yang dimaksud dengan lari?", "Sebutkan dua manfaat berlari!", "Mengapa kita harus pemanasan sebelum berlari?", "Sebutkan contoh kegiatan berlari di sekolah!", "Mengapa kita tidak boleh berlari sembarangan?"]
        },
        "STS": {
            pg: [
                {q:"Gerak meniru hewan berjalan termasuk gerak ‚Ä¶",opt:["Lokomotor","Non-lokomotor","Diam"],ans:0},
                {q:"Gambar anak sedang melompat seperti katak. Ini meniru hewan ‚Ä¶",opt:["Kucing","Katak","Burung"],ans:1},
                {q:"Gerak berpindah tempat disebut ‚Ä¶",opt:["Lokomotor","Non-lokomotor","Manipulatif"],ans:0},
                {q:"Hewan yang bergerak dengan cara melompat adalah ‚Ä¶",opt:["Kelinci","Ular","Ikan"],ans:0},
                {q:"Gerak berjalan ke depan melatih otot ‚Ä¶",opt:["Tangan","Kaki","Leher"],ans:1},
                {q:"Saat berlari, kaki melangkah dengan ‚Ä¶",opt:["Lambat","Cepat","Diam"],ans:1},
                {q:"Posisi badan saat berjalan tegak adalah ‚Ä¶",opt:["Miring","Bungkuk","Lurus"],ans:2},
                {q:"Gerak lokomotor yang dilakukan dengan satu kaki tumpuan adalah ‚Ä¶",opt:["Melompat","Meloncat","Duduk"],ans:0},
                {q:"Gerak tidak berpindah tempat disebut ‚Ä¶",opt:["Lokomotor","Non-lokomotor","Manipulatif"],ans:1},
                {q:"Contoh gerak non-lokomotor adalah ‚Ä¶",opt:["Berlari","Melompat","Mengayun lengan"],ans:2}
            ],
            isian: ["Gerakan memutar badan melatih kelenturan otot ‚Ä¶", "Mengayun lengan dilakukan di ‚Ä¶ (tempat)", "Menekuk lutut termasuk gerak ‚Ä¶", "Sikap kapal terbang melatih ‚Ä¶", "Pemanasan dilakukan agar tidak mengalami ‚Ä¶", "Sepak bola menggunakan bola ‚Ä¶", "Kasti menggunakan bola ‚Ä¶", "Alat bantu berenang agar mata tidak perih adalah ‚Ä¶", "Bola basket ukurannya lebih ‚Ä¶ dari bola kasti", "Menangkap bola menggunakan kedua ‚Ä¶"],
            essay: ["Sebutkan contoh gerak lokomotor!", "Sebutkan hewan yang bergerak dengan melompat!", "Jelaskan apa itu gerak non-lokomotor!", "Sebutkan dua contoh gerak non-lokomotor!", "Mengapa kita harus pemanasan?"]
        },
        "SAS": {
            pg: [
                {q:"Sikap duduk yang benar adalah ‚Ä¶",opt:["Membungkuk","Tegak","Tiduran"],ans:1},
                {q:"Gerak berirama mengikuti ‚Ä¶",opt:["Lampu","Musik","Teman"],ans:1},
                {q:"Sebelum berenang kita memakai ‚Ä¶",opt:["Jaket","Pakaian renang","Sepatu"],ans:1},
                {q:"Aktivitas air dilakukan di ‚Ä¶",opt:["Sawah","Kolam renang","Jalan"],ans:1},
                {q:"Agar badan bersih kita mandi menggunakan ‚Ä¶",opt:["Pasir","Sabun","Minyak"],ans:1},
                {q:"Mencuci tangan dilakukan sebelum ‚Ä¶",opt:["Tidur","Makan","Bermain"],ans:1},
                {q:"Membuang sampah di ‚Ä¶",opt:["Sungai","Tempat sampah","Halaman"],ans:1},
                {q:"Kuku harus ‚Ä¶ agar bersih",opt:["Dipanjangkan","Dipendekkan","Dibiarkan"],ans:1},
                {q:"Menggosok gigi dilakukan sebelum ‚Ä¶",opt:["Berlari","Tidur","Makan"],ans:1},
                {q:"Rambut dicuci menggunakan ‚Ä¶",opt:["Sabun","Sampo","Pasta gigi"],ans:1},
                {q:"Sikap berdiri yang benar adalah ‚Ä¶",opt:["Tegak","Miring","Membungkuk"],ans:0},
                {q:"Olahraga membuat badan ‚Ä¶",opt:["Lemah","Sehat","Sakit"],ans:1},
                {q:"Istirahat terbaik adalah ‚Ä¶",opt:["Main HP","Tidur","Menonton"],ans:1},
                {q:"Lingkungan bersih membuat kita ‚Ä¶",opt:["Sakit","Nyaman","Takut"],ans:1},
                {q:"Mandi minimal ‚Ä¶ kali sehari",opt:["1","2","5"],ans:1},
                {q:"Membersihkan telinga menggunakan alat yang ‚Ä¶",opt:["Tajam","Lembut","Keras"],ans:1},
                {q:"Pakaian kotor harus segera ‚Ä¶",opt:["Dipakai","Dicuci","Dibuang"],ans:1},
                {q:"Membaca buku di tempat yang ‚Ä¶",opt:["Gelap","Terang","Remang"],ans:1},
                {q:"Setelah olahraga tubuh terasa ‚Ä¶",opt:["Segar","Sedih","Marah"],ans:0},
                {q:"Menjaga kebersihan lingkungan adalah tugas ‚Ä¶",opt:["Guru","Semua orang","Satpam"],ans:1}
            ],
            isian: ["Mandi menggunakan air bersih dan ‚Ä¶", "Gerak irama mengikuti ‚Ä¶", "Alat bantu mengapung di air adalah ‚Ä¶", "Memotong kuku dilakukan ‚Ä¶ kali seminggu", "Mencuci tangan menggunakan sabun dan air ‚Ä¶", "Gigi dibersihkan menggunakan sikat dan ‚Ä¶", "Telinga dibersihkan menggunakan ‚Ä¶", "Pakaian sekolah harus selalu ‚Ä¶", "Rumah yang kotor menjadi sarang ‚Ä¶", "Jendela dibuka agar udara ‚Ä¶ masuk"],
            essay: ["Sebutkan dua cara menjaga kebersihan diri!", "Apa manfaat olahraga teratur?", "Sebutkan tiga sikap tubuh yang benar!", "Apa yang dilakukan sebelum masuk kolam renang?", "Mengapa kita harus mencuci tangan sebelum makan?"]
        }
    };

    // --- 2. CONFIG ---
    const firebaseConfig = {
        apiKey: "AIzaSyD7FsbgyUF1jvDvcrb6wrWlEiQJUFZG3kE",
        authDomain: "pjok-sekolah-bapak-rendi.firebaseapp.com",
        databaseURL: "https://pjok-sekolah-bapak-rendi-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "pjok-sekolah-bapak-rendi",
        appId: "1:337016584526:web:8534c7cf4012a35427861f"
    };

    let database = null;
    let currentBab = '';
    let currentSoal = null;

    document.addEventListener('DOMContentLoaded', () => {
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        database = firebase.database();

        const urlParams = new URLSearchParams(window.location.search);
        currentBab = urlParams.get('bab') || 'A';
        
        if (!BANK_SOAL[currentBab]) BANK_SOAL[currentBab] = BANK_SOAL['A'];

        currentSoal = BANK_SOAL[currentBab];
        document.getElementById('judul-kuis').innerText = `Kuis PJOK Bab ${currentBab}`;

        // === AUTO-FILL NAMA ===
        const savedNama = localStorage.getItem('siswa_nama');
        const savedKelas = localStorage.getItem('siswa_kelas');
        const savedSekolah = localStorage.getItem('siswa_sekolah');

        // Isi otomatis jika ada di memori
        if(savedNama) document.getElementById('inputNama').value = savedNama;
        if(savedKelas) document.getElementById('inputKelas').value = savedKelas;
        if(savedSekolah) document.getElementById('inputSekolah').value = savedSekolah;
    });

    window.mulaiKuis = function() {
        const nama = document.getElementById('inputNama').value;
        const kelas = document.getElementById('inputKelas').value;
        const sekolah = document.getElementById('inputSekolah').value;

        if (!nama || !kelas) {
            alert("Mohon isi Nama Siswa dan Kelas!");
            return;
        }

        // === KUNCI: UPDATE MEMORI DENGAN DATA TERBARU ===
        // Apapun yang diketik user sekarang, itulah yang disimpan.
        // Ini mengatasi masalah nama lama yang "nyangkut".
        localStorage.setItem('siswa_nama', nama);
        localStorage.setItem('siswa_kelas', kelas);
        localStorage.setItem('siswa_sekolah', sekolah);

        document.getElementById('form-identitas').style.display = 'none';
        document.getElementById('lembar-kuis').style.display = 'block';
        
        renderSoal();
    };

    function renderSoal() {
        const container = document.getElementById('container-soal');
        let html = '';

        if (currentSoal.pg) {
            html += `<div class="section-header">BAGIAN I: PILIHAN GANDA</div>`;
            currentSoal.pg.forEach((item, index) => {
                html += `
                <div class="soal-card">
                    <span class="soal-text">${index + 1}. ${item.q}</span>
                    ${item.opt.map((opt, i) => `
                        <label class="option-label">
                            <input type="radio" name="pg_${index}" value="${i}"> 
                            ${String.fromCharCode(65 + i)}. ${opt}
                        </label>
                    `).join('')}
                </div>`;
            });
        }

        if (currentSoal.isian && currentSoal.isian.length > 0) {
            html += `<div class="section-header">BAGIAN II: ISIAN SINGKAT</div>`;
            currentSoal.isian.forEach((soal, index) => {
                html += `
                <div class="soal-card">
                    <span class="soal-text">Soal ${index + 1}: ${soal}</span>
                    <input type="text" class="form-control" id="isian_${index}">
                </div>`;
            });
        }

        if (currentSoal.essay) {
            html += `<div class="section-header">BAGIAN III: URAIAN</div>`;
            currentSoal.essay.forEach((soal, index) => {
                html += `
                <div class="soal-card">
                    <span class="soal-text">Soal ${index + 1}: ${soal}</span>
                    <textarea class="form-control" id="essay_${index}" rows="3"></textarea>
                </div>`;
            });
        }

        container.innerHTML = html;
        window.scrollTo(0, 0);
    }

    window.kirimJawaban = function() {
        if (!confirm("Kirim jawaban sekarang?")) return;

        let skorPG = 0;
        let benar = 0;
        let totalPG = currentSoal.pg ? currentSoal.pg.length : 0;
        if (totalPG > 0) {
            currentSoal.pg.forEach((item, index) => {
                const radio = document.querySelector(`input[name="pg_${index}"]:checked`);
                if (radio && parseInt(radio.value) === item.ans) benar++;
            });
            skorPG = Math.round((benar / totalPG) * 100);
        }

        let jIsian = [];
        if(currentSoal.isian) currentSoal.isian.forEach((_, i) => jIsian.push(document.getElementById(`isian_${i}`).value || "-"));
        
        let jEssay = [];
        if(currentSoal.essay) currentSoal.essay.forEach((_, i) => jEssay.push(document.getElementById(`essay_${i}`).value || "-"));

        // GUNAKAN DATA DARI LOCAL STORAGE (YANG BARU DIUPDATE)
        const data = {
            nama: localStorage.getItem('siswa_nama'),
            kelas: localStorage.getItem('siswa_kelas'),
            guru: document.getElementById('inputGuru').value,
            sekolah: localStorage.getItem('siswa_sekolah'),
            bab: currentBab,
            nilai_pg: skorPG,
            jawaban_isian: jIsian,
            jawaban_essay: jEssay,
            waktu: new Date().toLocaleString()
        };

        const loading = document.getElementById('loading-overlay');
        loading.style.display = 'block';
        document.getElementById('lembar-kuis').style.display = 'none';

        const uid = data.nama.replace(/[^a-zA-Z0-9]/g, "_").toLowerCase() + "_" + Date.now();
        database.ref(`hasil_kuis/kelas_1/${currentBab}/${uid}`).set(data)
            .then(() => {
                loading.style.display = 'none';
                document.getElementById('hasil-area').style.display = 'block';
                document.getElementById('skor-akhir').innerText = skorPG;
            });
    };
</script>
</body>
</html>