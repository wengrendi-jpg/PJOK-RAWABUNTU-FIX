<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis PJOK - SDN Rawabuntu 03</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body{font-family:'Nunito',sans-serif;background:#e3f2fd;margin:0;padding:20px;color:#333}
        .container{max-width:600px;margin:auto;background:white;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
        h2, h3{text-align:center;color:#e91e63;margin-bottom:20px}
        
        .input-group{margin-bottom:15px}
        .input-group label{display:block;margin-bottom:5px;font-weight:700;font-size:14px}
        .form-control{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-family:inherit;box-sizing:border-box}
        .form-control:focus{border-color:#29b6f6;outline:none}

        .section-header{background:#0288d1;color:white;padding:10px 15px;border-radius:8px;margin:25px 0 15px;font-weight:800;font-size:16px}
        .soal-card{background:#f9fbe7;border:1px solid #dce775;padding:15px;border-radius:10px;margin-bottom:15px}
        .soal-text{font-weight:700;margin-bottom:10px;display:block}
        
        .option-label{display:block;padding:10px;background:white;border:1px solid #ddd;border-radius:8px;margin-bottom:5px;cursor:pointer;transition:0.2s}
        .option-label:hover{background:#e1f5fe;border-color:#29b6f6}
        input[type="radio"]{margin-right:10px}

        .btn{width:100%;padding:14px;border:none;border-radius:50px;font-weight:800;font-size:16px;cursor:pointer;margin-top:20px;text-transform:uppercase;transition:0.3s}
        .btn-start{background:linear-gradient(to right, #e91e63, #c2185b);color:white}
        .btn-submit{background:linear-gradient(to right, #43a047, #2e7d32);color:white}
        .btn-back{background:#757575;color:white}

        #loading-overlay{display:none;text-align:center;padding:20px}
        #hasil-area{display:none;text-align:center}
        .score-circle{width:120px;height:120px;background:#e91e63;color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:40px;font-weight:800;margin:0 auto 20px}
    </style>
</head>
<body>

<div class="container">
    <div id="form-identitas">
        <h2>üìã DATA SISWA</h2>
        <div class="input-group">
            <label>Nama Lengkap Siswa</label>
            <input type="text" id="inputNama" class="form-control" placeholder="Tulis nama lengkap...">
        </div>
        <div class="input-group">
            <label>Kelas</label>
            <select id="inputKelas" class="form-control">
                <option value="">-- Pilih Kelas --</option>
                <option value="1A">Kelas 1A</option>
                <option value="1B">Kelas 1B</option>
                <option value="1C">Kelas 1C</option>
                <option value="1D">Kelas 1D</option>
                <option value="1E">Kelas 1E</option>
            </select>
        </div>
        <div class="input-group">
            <label>Nama Guru PJOK</label>
            <input type="text" id="inputGuru" class="form-control" value="Bapak Rendi">
        </div>
        <div class="input-group">
            <label>Asal Sekolah</label>
            <input type="text" id="inputSekolah" class="form-control" value="SDN Rawabuntu 03">
        </div>
        <button class="btn btn-start" onclick="mulaiKuis()">üöÄ MULAI MENGERJAKAN</button>
    </div>

    <div id="lembar-kuis" style="display:none;">
        <h3 id="judul-kuis">Soal PJOK</h3>
        <div id="container-soal"></div>
        <button class="btn btn-submit" onclick="kirimJawaban()">‚úÖ KIRIM JAWABAN</button>
    </div>

    <div id="hasil-area">
        <h2>üéâ SELESAI!</h2>
        <p>Nilai Pilihan Ganda Kamu:</p>
        <div class="score-circle" id="skor-akhir">0</div>
        <p>Jawaban Isian & Essay sudah dikirim ke Bapak Guru.</p>
        <a href="materi-kelas-1.html" class="btn btn-back" style="display:block; text-decoration:none; text-align:center;">üè† KEMBALI KE MATERI</a>
    </div>
</div>

<script>
    // 1. BANK SOAL (Dilengkapi dengan Kunci Jawaban: ans)
    // ans: 0 = A, 1 = B, 2 = C
    const BANK_SOAL = {
        "A": { 
            pg: [
                {q:"Berjalan adalah gerakan berpindah tempat. Gerakan ini disebut ‚Ä¶",opt:["Gerak lokomotor","Gerak non-lokomotor","Gerak diam"], ans:0}, 
                {q:"Posisi badan saat berjalan harus ‚Ä¶",opt:["Membungkuk","Tegak","Miring"], ans:1}, 
                {q:"Berjalan melatih otot ‚Ä¶",opt:["Tangan","Leher","Kaki"], ans:2}, 
                {q:"Pandangan mata saat berjalan ke arah ‚Ä¶",opt:["Bawah","Depan","Atas"], ans:1}, 
                {q:"Lari lebih ‚Ä¶ daripada jalan.",opt:["Lambat","Cepat","Sama"], ans:1}
            ], 
            isian: [], essay: ["Apa itu gerak lokomotor?"] 
        },
        "STS": { 
            pg: [
                {q:"Gerak meniru hewan berjalan termasuk gerak ‚Ä¶",opt:["Lokomotor","Non-lokomotor","Diam"], ans:0},
                {q:"Gambar anak sedang melompat seperti katak. Ini meniru hewan ‚Ä¶",opt:["Kucing","Katak","Burung"], ans:1},
                {q:"Gerak berpindah tempat disebut ‚Ä¶",opt:["Lokomotor","Non-lokomotor","Manipulatif"], ans:0},
                {q:"Hewan yang bergerak dengan cara melompat adalah ‚Ä¶",opt:["Kelinci","Ular","Ikan"], ans:0},
                {q:"Gerak berjalan ke depan melatih otot ‚Ä¶",opt:["Tangan","Kaki","Leher"], ans:1}
            ],
            isian: ["Gerakan memutar..."], essay: ["Sebutkan..."] 
        },
        "SAS": { 
            pg: [
                {q:"Sikap duduk yang benar adalah ‚Ä¶",opt:["Membungkuk","Tegak","Tiduran"], ans:1}
            ], 
            isian: ["Mandi pakai..."], essay: ["Sebutkan alat kebersihan!"] 
        }
    };
    
    // Copy soal ke bab lain agar tidak error
    ['B','C','D','E','F','G','H'].forEach(bab => { if(!BANK_SOAL[bab]) BANK_SOAL[bab] = BANK_SOAL['A']; });

    // 2. CONFIG FIREBASE
    const firebaseConfig = {
        apiKey: "AIzaSyD7FsbgyUF1jvDvcrb6wrWlEiQJUFZG3kE",
        authDomain: "pjok-sekolah-bapak-rendi.firebaseapp.com",
        databaseURL: "https://pjok-sekolah-bapak-rendi-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "pjok-sekolah-bapak-rendi",
        appId: "1:337016584526:web:8534c7cf4012a35427861f"
    };
    
    let database;
    let currentBab = 'A';
    let currentSoal = null;

    document.addEventListener('DOMContentLoaded', () => {
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        database = firebase.database();

        const urlParams = new URLSearchParams(window.location.search);
        currentBab = urlParams.get('bab') || 'A';
        
        if (!BANK_SOAL[currentBab]) BANK_SOAL[currentBab] = BANK_SOAL['A'];
        currentSoal = BANK_SOAL[currentBab];

        document.getElementById('judul-kuis').innerText = `Kuis PJOK Bab ${currentBab}`;

        const savedNama = localStorage.getItem('siswa_nama');
        const savedKelas = localStorage.getItem('siswa_kelas');
        if(savedNama) document.getElementById('inputNama').value = savedNama;
        if(savedKelas) document.getElementById('inputKelas').value = savedKelas;
    });

    window.mulaiKuis = function() {
        const nama = document.getElementById('inputNama').value;
        const kelas = document.getElementById('inputKelas').value;
        
        if (!nama || !kelas) { alert("Isi Nama dan Kelas!"); return; }

        localStorage.setItem('siswa_nama', nama);
        localStorage.setItem('siswa_kelas', kelas);

        document.getElementById('form-identitas').style.display = 'none';
        document.getElementById('lembar-kuis').style.display = 'block';
        renderSoal();
    };

    function renderSoal() {
        const container = document.getElementById('container-soal');
        let html = '';

        if (currentSoal.pg && currentSoal.pg.length > 0) {
            html += `<div class="section-header">BAGIAN I: PILIHAN GANDA</div>`;
            currentSoal.pg.forEach((item, index) => {
                html += `
                <div class="soal-card">
                    <span class="soal-text">${index + 1}. ${item.q}</span>
                    ${item.opt.map((opt, i) => `
                        <label class="option-label">
                            <input type="radio" name="pg_${index}" value="${i}"> 
                            ${String.fromCharCode(65 + i)}. ${opt}
                        </label>
                    `).join('')}
                </div>`;
            });
        }
        
        container.innerHTML = html;
        window.scrollTo(0, 0);
    }

    // --- FUNGSI PENTING: HITUNG NILAI & KIRIM KE FIREBASE ---
    window.kirimJawaban = function() {
        if (!confirm("Yakin ingin mengirim jawaban?")) return;
        
        const btn = document.querySelector('.btn-submit');
        btn.innerHTML = "‚è≥ Mengirim...";
        btn.disabled = true;

        let skor = 0;
        let benar = 0;
        const totalSoal = currentSoal.pg ? currentSoal.pg.length : 0;

        // 1. Hitung Nilai PG
        if (totalSoal > 0) {
            currentSoal.pg.forEach((item, index) => {
                const radios = document.getElementsByName(`pg_${index}`);
                for(let r of radios) {
                    if(r.checked && parseInt(r.value) === item.ans) {
                        benar++;
                    }
                }
            });
            skor = Math.round((benar / totalSoal) * 100);
        }

        // 2. Siapkan Data
        const dataSiswa = {
            nama: localStorage.getItem('siswa_nama'),
            kelas: localStorage.getItem('siswa_kelas'),
            nilai_pg: skor,
            waktu: new Date().toLocaleString()
        };

        // 3. Kirim ke Firebase (INILAH KUNCINYA)
        database.ref(`hasil_kuis/kelas_1/${currentBab}`).push(dataSiswa)
            .then(() => {
                // Sukses
                document.getElementById('lembar-kuis').style.display = 'none';
                document.getElementById('hasil-area').style.display = 'block';
                document.getElementById('skor-akhir').innerText = skor;
            })
            .catch((error) => {
                alert("Gagal mengirim nilai: " + error.message);
                btn.innerHTML = "‚úÖ KIRIM JAWABAN";
                btn.disabled = false;
            });
    };
</script>
</body>
</html>